{% extends "base.html" %}
{% block content %}

<h1 class="mb-3">‚ûï –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∞ –∑–∞–¥–∞—á–∞</h1>

<form action="/add" method="post" class="mb-4">
  <div class="row g-2 align-items-end">

    <div class="col-md-3">
      <input type="text" name="name" class="form-control" placeholder="–ò–º–µ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞" required>
    </div>

    <div class="col-md-2">
      <input type="number" name="priority" class="form-control" placeholder="–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç" min="1" max="5" required>
    </div>

    <div class="col-md-3">
      <input type="date" name="due_date" class="form-control" required>
    </div>

    <div class="col-md-2">
      <select name="category" id="category" class="form-control" onchange="toggleCustomCategory()" required>
        <option value="–†–∞–±–æ—Ç–∞">–†–∞–±–æ—Ç–∞</option>
        <option value="–£—á–µ–Ω–µ">–£—á–µ–Ω–µ</option>
        <option value="–õ–∏—á–Ω–æ">–õ–∏—á–Ω–æ</option>
        <option value="–î–æ–º">–î–æ–º</option>
        <option value="–•–æ–±–∏">–•–æ–±–∏</option>
        <option value="–ó–¥—Ä–∞–≤–µ">–ó–¥—Ä–∞–≤–µ</option>
        <option value="–î—Ä—É–≥–æ">–î—Ä—É–≥–æ</option>
      </select>
    </div>

    <div class="col-md-2" id="customCategoryContainer" style="display:none;">
      <input type="text" name="custom_category" id="custom_category" class="form-control" placeholder="–í—ä–≤–µ–¥–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
    </div>

    <div class="col-md-2 d-grid">
      <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏</button>
    </div>
  </div>
</form>

<script>
function toggleCustomCategory() {
  const select = document.getElementById("category");
  const customContainer = document.getElementById("customCategoryContainer");
  const customInput = document.getElementById("custom_category");

  if (select.value === "–î—Ä—É–≥–æ") {
    customContainer.style.display = "block";
    customInput.required = true;
  } else {
    customContainer.style.display = "none";
    customInput.required = false;
  }
}
</script>

<h2 class="mt-4 mb-3">üìã –í—Å–∏—á–∫–∏ –∑–∞–¥–∞—á–∏</h2>

<table class="table table-hover align-middle">
  <thead class="table-light">
    <tr>
      <th>–ò–º–µ</th>
      <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
      <th>–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    <tr>
      <form action="/edit/{{ task.id }}" method="post" class="d-flex">
        <td><input type="text" name="name" value="{{ task.name }}" class="form-control form-control-sm"></td>
        <td><input type="number" name="priority" value="{{ task.priority }}" class="form-control form-control-sm"></td>
        <td><input type="date" name="due_date" value="{{ task.due_date }}" class="form-control form-control-sm"></td>
        <td><input type="text" name="status" value="{{ task.status }}" class="form-control form-control-sm"></td>
        <td><input type="text" name="category" value="{{ task.category }}" class="form-control form-control-sm"></td>
        <td class="d-flex gap-1">
          <button type="submit" class="btn btn-outline-success btn-sm">üíæ</button>
      </form>
      <form action="/delete/{{ task.id }}" method="post">
        <button type="submit" class="btn btn-outline-danger btn-sm">üóëÔ∏è</button>
      </form>
      <form action="/complete/{{ task.id }}" method="post">
        <button type="submit" class="btn btn-outline-primary btn-sm">‚úÖ</button>
      </form>
        </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6" class="text-center text-muted">–ù—è–º–∞ –∑–∞–¥–∞—á–∏.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
