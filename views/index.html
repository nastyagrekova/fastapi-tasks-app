{% extends "base.html" %}
{% block content %}

<h1 class="mb-3 text-center">ü§ñ –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–µ–Ω –ø–æ–º–æ—â–Ω–∏–∫ –∑–∞ –ø–ª–∞–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∏</h1>

<p class="text-secondary mb-4 text-center">
  –°—ä–∑–¥–∞–≤–∞ —Å–ø–∏—Å—ä–∫ —Å—ä—Å –∑–∞–¥–∞—á–∏; –∫–ª–∞—Å–∏—Ñ–∏—Ü–∏—Ä–∞ –≥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏ —Å—Ä–æ–∫; –ø—Ä–µ–¥–ª–∞–≥–∞ –æ–ø—Ç–∏–º–∞–ª–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ.
</p>

<h2 class="mt-4 mb-3">üìã –í—Å–∏—á–∫–∏ –∑–∞–¥–∞—á–∏</h2>

<div class="row justify-content-center mb-4">
  <div class="col-md-5">
    <input type="text" id="searchInput" class="form-control" placeholder="–¢—ä—Ä—Å–∏ –∑–∞–¥–∞—á–∞ –ø–æ –∏–º–µ...">
  </div>
  <div class="col-md-3">
    <select id="categoryFilter" class="form-select">
      <option value="–í—Å–∏—á–∫–∏">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
      <option value="–†–∞–±–æ—Ç–∞">–†–∞–±–æ—Ç–∞</option>
      <option value="–£—á–µ–Ω–µ">–£—á–µ–Ω–µ</option>
      <option value="–õ–∏—á–Ω–æ">–õ–∏—á–Ω–æ</option>
      <option value="–î–æ–º">–î–æ–º</option>
      <option value="–î—Ä—É–≥–æ">–î—Ä—É–≥–æ</option>
    </select>
  </div>
</div>

<table class="table table-hover align-middle shadow-sm rounded">
  <thead class="table-light">
    <tr>
      <th>–ò–º–µ</th>
      <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
      <th>–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
    </tr>
  </thead>
  <tbody id="taskTable">
    {% for task in tasks %}
    <tr data-category="{{ task.category }}">
      <td>{{ task.name }}</td>
      <td>{{ task.category }}</td>
      <td>{{ task.priority }}</td>
      <td>{{ task.due_date }}</td>
      <td>{{ task.status }}</td>
    </tr>
    {% else %}
    <tr>
      <td colspan="5" class="text-center text-muted">–ù—è–º–∞ –¥–æ–±–∞–≤–µ–Ω–∏ –∑–∞–¥–∞—á–∏.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="mt-3 d-flex justify-content-between align-items-center">
  <div id="taskCount" class="text-muted"></div>
  <a href="/add" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤–∞ –∑–∞–¥–∞—á–∞</a>
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const categoryFilter = document.getElementById('categoryFilter');
  const rows = document.querySelectorAll('#taskTable tr');
  const taskCount = document.getElementById('taskCount');

  const mainCategories = ["–†–∞–±–æ—Ç–∞", "–£—á–µ–Ω–µ", "–õ–∏—á–Ω–æ", "–î–æ–º"];

  function updateVisibleRows() {
    const search = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    let visibleCount = 0;

    rows.forEach(row => {
      const name = row.cells[0].textContent.toLowerCase();
      const rowCategory = row.getAttribute('data-category');
      const matchesSearch = name.includes(search);

      let matchesCategory = false;

      if (selectedCategory === "–í—Å–∏—á–∫–∏") {
        matchesCategory = true;
      } else if (selectedCategory === "–î—Ä—É–≥–æ") {
        matchesCategory = !mainCategories.includes(rowCategory);
      } else {
        matchesCategory = rowCategory === selectedCategory;
      }

      if (matchesSearch && matchesCategory) {
        row.style.display = '';
        visibleCount++;
      } else {
        row.style.display = 'none';
      }
    });

    taskCount.textContent = visibleCount > 0
      ? `–ü–æ–∫–∞–∑–∞–Ω–∏ –∑–∞–¥–∞—á–∏: ${visibleCount}`
      : "–ù—è–º–∞ –∑–∞–¥–∞—á–∏, –æ—Ç–≥–æ–≤–∞—Ä—è—â–∏ –Ω–∞ —Ñ–∏–ª—Ç—ä—Ä–∞.";
  }

  searchInput.addEventListener('input', updateVisibleRows);
  categoryFilter.addEventListener('change', updateVisibleRows);
  updateVisibleRows();
</script>

{% endblock %}
